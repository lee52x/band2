<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<!-- 커뮤니티 회원가입 & 운영진의 회원정보 입력 -->
	<insert id="insertMember" parameterType="com.band.member.member.Member">
		INSERT INTO member_${url}(memberNo, userId, pwd, name, birth, address, gender, email, tel, joinDate, grade, groupUrl)
		VALUES(member_seq.NEXTVAL, #{userId, jdbcType = VARCHAR}, #{pwd, jdbcType = VARCHAR}, #{name}, #{birth}, #{address}, #{gender}, #{email}, #{tel}, #{joinDate}, #{grade}, #{url})
	</insert>

	<!-- 회원정보 목록 -->
	<select id="listMember" parameterType="map" resultType="com.band.member.member.Member">		
		SELECT memberNo, userId, name, email, TO_CHAR(birth, 'YYYY-MM-DD') birth, tel, address, gender,
			   grade, groupUrl, TO_CHAR(joinDate, 'YYYY-MM-DD') joinDate                       
		FROM member_${url}			
		ORDER BY memberNo ASC			
	</select>
	
	<!-- 회원정보 수정 -->
	<update id="updateMember" parameterType="com.band.member.member.Member">
		UPDATE member_${url} SET name = #{name}, email = #{email}, birth = #{birth}, tel = #{tel}, grade = #{grade}, address = #{address}, gender = #{gender}, joinDate = #{joinDate}
		WHERE memberNo = #{memberNo}
	</update>
	
	<!-- 회원정보 삭제 -->
	<delete id="deleteMember" parameterType="map">
		DELETE FROM member_${url} WHERE memberNo = #{memberNo} 
	</delete>
	
	<!-- 전체회원수 검색 -->
	<select id="selectTotalMember" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(memberNo), 0) FROM member_${url}
	</select>

	
	<!-- 커뮤니티회원수 검색 -->
	<select id="selectCommunityMember" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(userId), 0) FROM member_${url}
	</select>
	
	<!-- 새로 가입한 회원수 검색 -->
	<select id="recentJoinMemberCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(memberNo), 0) FROM member_${url}
	<![CDATA[
		WHERE joinDate >= (SELECT TO_CHAR(TRUNC(SYSDATE, 'MONTH'), 'YYYY-MM-DD') FROM dual)
		AND joinDate <= SYSDATE
	]]>
	</select>
	
	<!-- 현재 날짜가 속한 달의 시작일 검색  -->
	<select id="selectFirstday" resultType="String">
		SELECT TO_CHAR(TRUNC(SYSDATE, 'MONTH'), 'YYYY-MM-DD') FROM dual
	</select>
	
	<!-- 현재 날짜 검색 -->
	<select id="selectToday" resultType="String">
		SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD') FROM dual
	</select>
	
	<!-- 모임 창립일 검색 -->
	<select id="selectFoundationday" parameterType="map" resultType="String">
		SELECT TO_CHAR(foundationDay, 'YYYY-MM-DD') FROM community WHERE groupURL = #{url}
	</select>
	
	<!-- 창립일 계산 -->
	<select id="countFoundationday" parameterType="map" resultType="Integer">
		SELECT ROUND(
			SYSDATE	- (SELECT foundationDay
			FROM community
		    WHERE groupURL = #{url})) - 1 FROM dual
	</select>
	
	<!-- 최근 가입한 회원정보 검색 -->
	<select id="listRecentJoinMember" parameterType="map" resultType="com.band.member.member.Member">
		SELECT ROWNUM, tb.* FROM (
			SELECT name, userId, TO_CHAR(joinDate, 'YYYY-MM-DD') joinDate FROM member_${url}
			ORDER BY joinDate DESC
	<![CDATA[
		) tb WHERE ROWNUM <= 5
	]]>
	</select>	
	
</mapper>